<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ëª¨ì„ ì •ì‚° í”„ë¡œê·¸ë¨</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffcc00">
<style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; padding: 20px; }
    h1, h2 { text-align: center; }
    .page { display: none; }
    .active { display: block; }
    input, select, textarea { padding: 5px; margin: 3px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    button { padding: 8px 15px; margin-top: 10px; cursor: pointer; }
    .pay-btn { background-color: #ffcc00; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer; }

    /* ğŸ“± ëª¨ë°”ì¼ í™”ë©´ ìµœì í™” */
    @media (max-width: 768px) {
        body { font-size: 16px; padding: 10px; }
        table { font-size: 14px; }
        th, td { padding: 8px; }
        input, select, textarea { width: 100%; font-size: 16px; }
        button, .pay-btn { font-size: 16px; padding: 10px; width: 100%; margin-top: 5px; }
        h1 { font-size: 22px; }
        h2 { font-size: 18px; }
    }

    /* ğŸ’» PC í™”ë©´ ìµœì í™” */
    @media (min-width: 769px) {
        body { font-size: 18px; }
        table { font-size: 16px; }
        input, select, textarea { font-size: 16px; }
    }
</style>
</head>
<body>

<h1>ëª¨ì„ ì •ì‚° í”„ë¡œê·¸ë¨</h1>

<!-- í˜ì´ì§€ 1: ì°¸ì„ì ì…ë ¥ -->
<div class="page active" id="page1">
    <h2>1ë‹¨ê³„: ì°¸ì„ì ì…ë ¥</h2>
    <textarea id="participants" placeholder="ì°¸ì„ì ì´ë¦„ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”" style="width:100%; height:150px;"></textarea>
    <br>
    <button onclick="goToExpenses()">ë‹¤ìŒ ë‹¨ê³„</button>
</div>

<!-- í˜ì´ì§€ 2: ì§€ì¶œ ë‚´ì—­ ì…ë ¥ -->
<div class="page" id="page2">
    <h2>2ë‹¨ê³„: ì§€ì¶œ ë‚´ì—­ ì…ë ¥</h2>
    <table id="expensesTable">
        <tr>
            <th>ì§€ì¶œ ë‚´ì—­</th>
            <th>ì§€ì¶œ ê¸ˆì•¡(ì›)</th>
            <th>ì§€ì¶œì</th>
            <th>ì‚­ì œ</th>
        </tr>
    </table>
    <button onclick="addExpenseRow()">í–‰ ì¶”ê°€</button>
    <button onclick="calculate()">ì •ì‚°í•˜ê¸°</button>
</div>

<!-- í˜ì´ì§€ 3: ê²°ê³¼ ì¶œë ¥ -->
<div class="page" id="page3">
    <h2>ì •ì‚° ê²°ê³¼</h2>
    <div id="details"></div>
    <div id="summary"></div>
    <button onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
</div>

<script>
let names = [];
let expenses = [];
const bankName = "ì¹´ì¹´ì˜¤ë±…í¬";
const accountNumber = "3333-12-3456789";
const accountHolder = "í™ê¸¸ë™";

function goToExpenses() {
    const input = document.getElementById("participants").value.trim();
    if (!input) { alert("ì°¸ì„ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”."); return; }
    names = input.split("\n").map(name => name.trim()).filter(name => name);
    if (names.length < 2) { alert("ìµœì†Œ 2ëª… ì´ìƒ ì…ë ¥í•˜ì„¸ìš”."); return; }

    addExpenseRow(); // ì²« í–‰ ì¶”ê°€
    showPage(2);
}

function addExpenseRow() {
    const table = document.getElementById("expensesTable");
    const row = table.insertRow(-1);

    row.insertCell(0).innerHTML = `<input type="text" placeholder="ì˜ˆ: ì‹ì‚¬" style="width:95%;">`;
    row.insertCell(1).innerHTML = `<input type="number" min="0" value="0" style="width:90%;">`;

    let selectHTML = `<select style="width:95%;">`;
    names.forEach(name => {
        selectHTML += `<option value="${name}">${name}</option>`;
    });
    selectHTML += `</select>`;
    row.insertCell(2).innerHTML = selectHTML;

    row.insertCell(3).innerHTML = `<button onclick="deleteRow(this)">ì‚­ì œ</button>`;
}

function deleteRow(btn) {
    const row = btn.parentNode.parentNode;
    document.getElementById("expensesTable").deleteRow(row.rowIndex);
}

function calculate() {
    expenses = [];
    const table = document.getElementById("expensesTable");
    let total = 0;

    for (let i = 1; i < table.rows.length; i++) {
        const desc = table.rows[i].cells[0].querySelector("input").value.trim() || "-";
        const amount = parseFloat(table.rows[i].cells[1].querySelector("input").value) || 0;
        const payer = table.rows[i].cells[2].querySelector("select").value;
        expenses.push({ desc, amount, payer });
        total += amount;
    }

    const perPerson = total / names.length;
    let paidMap = {};
    names.forEach(name => paidMap[name] = 0);
    expenses.forEach(exp => paidMap[exp.payer] += exp.amount);

    let detailsHTML = `<h3>ğŸ“œ ì§€ì¶œ ë‚´ì—­</h3>
        <table>
        <tr><th>ì§€ì¶œ ë‚´ì—­</th><th>ê¸ˆì•¡(ì›)</th><th>ì§€ì¶œì</th></tr>`;
    expenses.forEach(exp => {
        detailsHTML += `<tr>
            <td>${exp.desc}</td>
            <td>${exp.amount.toLocaleString()}</td>
            <td>${exp.payer}</td>
        </tr>`;
    });
    detailsHTML += `</table>`;
    document.getElementById("details").innerHTML = detailsHTML;

    let summaryHTML = `<h3>ğŸ’° ì •ì‚° ìš”ì•½</h3>
        <table>
        <tr><th>ì´ë¦„</th><th>ì§€ì¶œì•¡</th><th>1ì¸ë‹¹ ë¶€ë‹´ê¸ˆ</th><th>ì°¨ì•¡</th><th>ê²°ê³¼</th></tr>`;
    names.forEach(name => {
        let diff = paidMap[name] - perPerson;
        let resultText = "";
        if (diff > 0) {
            resultText = `${Math.round(diff).toLocaleString()} ì› ë°›ê¸°`;
        } else if (diff < 0) {
            let payAmount = Math.abs(Math.round(diff));
            resultText = `${payAmount.toLocaleString()} ì› ë‚´ê¸° <br>
                          <button class="pay-btn" onclick="copyAccount(${payAmount})">ê³„ì¢Œ ë³µì‚¬</button>`;
        } else {
            resultText = "ì •ì‚° ì™„ë£Œ";
        }
        summaryHTML += `<tr>
            <td>${name}</td>
            <td>${paidMap[name].toLocaleString()} ì›</td>
            <td>${Math.round(perPerson).toLocaleString()} ì›</td>
            <td>${Math.round(diff).toLocaleString()} ì›</td>
            <td>${resultText}</td>
        </tr>`;
    });
    summaryHTML += `</table>`;
    document.getElementById("summary").innerHTML = summaryHTML;

    showPage(3);
}

function copyAccount(amount) {
    const text = `${bankName} ${accountNumber} (${accountHolder}) - ${amount.toLocaleString()}ì›`;
    navigator.clipboard.writeText(text).then(() => {
        alert("ê³„ì¢Œë²ˆí˜¸ì™€ ê¸ˆì•¡ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤:\n" + text);
    });
}

function showPage(pageNum) {
    document.querySelectorAll(".page").forEach((p, i) => {
        p.classList.remove("active");
        if (i === pageNum - 1) p.classList.add("active");
    });
}

// PWA ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js").then(() => {
        console.log("ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì™„ë£Œ");
    });
}
</script>

</body>
</html>
